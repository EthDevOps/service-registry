@model QuokkaServiceRegistry.Models.CatalogService

@{
    ViewData["Title"] = "Service Details";
}

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1>@ViewData["Title"] - @Model.Name</h1>
                <div>
                    <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-primary">
                        <i class="fas fa-edit"></i> Edit
                    </a>
                    <a asp-action="Index" class="btn btn-secondary">
                        <i class="fas fa-arrow-left"></i> Back to List
                    </a>
                </div>
            </div>

            @if (TempData["Success"] != null)
            {
                <div class="alert alert-success alert-dismissible fade show" role="alert">
                    <i class="fas fa-check-circle"></i> @TempData["Success"]
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            }
            
            @if (TempData["Error"] != null)
            {
                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                    <i class="fas fa-exclamation-triangle"></i> @TempData["Error"]
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            }

            <div class="row">
                <!-- Main Information -->
                <div class="col-lg-8">
                    <!-- Basic Information -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-info-circle"></i> Basic Information
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <dl class="row">
                                        <dt class="col-sm-4">Service Name:</dt>
                                        <dd class="col-sm-8"><strong>@Model.Name</strong></dd>
                                        
                                        <dt class="col-sm-4">Service Type:</dt>
                                        <dd class="col-sm-8">
                                            @if (Model.IsPropriety)
                                            {
                                                <span class="badge bg-warning">Proprietary</span>
                                            }
                                            else
                                            {
                                                <span class="badge bg-success">Open Source</span>
                                            }
                                        </dd>
                                        
                                    </dl>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Vendor Information -->
                    @if (Model.Vendor != null)
                    {
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5 class="card-title mb-0">
                                    <i class="fas fa-building"></i> Vendor Information
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <dl class="row">
                                            <dt class="col-sm-4">Vendor Name:</dt>
                                            <dd class="col-sm-8">@Model.Vendor.Name</dd>
                                            
                                            <dt class="col-sm-4">Website:</dt>
                                            <dd class="col-sm-8">
                                                <a href="@Model.Vendor.WebsiteUrl" target="_blank" class="btn btn-outline-primary btn-sm">
                                                    <i class="fas fa-external-link-alt"></i> Visit Website
                                                </a>
                                            </dd>
                                            
                                            @if (!string.IsNullOrEmpty(Model.Vendor.Country) || !string.IsNullOrEmpty(Model.Vendor.City))
                                            {
                                                <dt class="col-sm-4">Location:</dt>
                                                <dd class="col-sm-8">@Model.Vendor.City, @Model.Vendor.Country</dd>
                                            }
                                            
                                            <dt class="col-sm-4">GDPR Agreement:</dt>
                                            <dd class="col-sm-8">
                                                @if (Model.Vendor.GdprProcessingAgreementExists)
                                                {
                                                    <span class="badge bg-success">
                                                        <i class="fas fa-check"></i> Agreement Exists
                                                    </span>
                                                    @if (!string.IsNullOrEmpty(Model.Vendor.ProcessingAgreementLink))
                                                    {
                                                        <a href="@Model.Vendor.ProcessingAgreementLink" target="_blank" class="btn btn-outline-info btn-sm ms-2">
                                                            <i class="fas fa-file-contract"></i> View Agreement
                                                        </a>
                                                    }
                                                }
                                                else
                                                {
                                                    <span class="badge bg-danger">
                                                        <i class="fas fa-exclamation-triangle"></i> No Agreement
                                                    </span>
                                                }
                                            </dd>
                                        </dl>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }

                    <!-- License Information -->
                    @if (Model.License != null)
                    {
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5 class="card-title mb-0">
                                    <i class="fas fa-certificate"></i> License Information
                                </h5>
                            </div>
                            <div class="card-body">
                                <dl class="row">
                                    <dt class="col-sm-3">License Name:</dt>
                                    <dd class="col-sm-9">
                                        <span class="badge bg-info me-2">@Model.License.Abbreviation</span>
                                        @Model.License.Name
                                    </dd>
                                    
                                    <dt class="col-sm-3">License URL:</dt>
                                    <dd class="col-sm-9">
                                        <a href="@Model.License.LicenseUrl" target="_blank" class="btn btn-outline-secondary btn-sm">
                                            <i class="fas fa-external-link-alt"></i> View License
                                        </a>
                                    </dd>
                                </dl>
                            </div>
                        </div>
                    }

                    <!-- Hosting Information -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-server"></i> Hosting Information
                            </h5>
                        </div>
                        <div class="card-body">
                            <dl class="row">
                                <dt class="col-sm-3">Hosting Type:</dt>
                                <dd class="col-sm-9">
                                    <span class="badge @(Model.HostingType == CatalogHostingType.SaaS ? "bg-success" : "bg-warning")">
                                        @Model.HostingType
                                    </span>
                                </dd>
                                
                                <dt class="col-sm-3">Hosting Country:</dt>
                                <dd class="col-sm-9">@Model.HostingCountry</dd>
                                
                                @if (!string.IsNullOrEmpty(Model.SaasRegionReference))
                                {
                                    <dt class="col-sm-3">SaaS Region:</dt>
                                    <dd class="col-sm-9">@Model.SaasRegionReference</dd>
                                }
                            </dl>
                            
                            @if (Model.OnpremiseHosts != null && Model.OnpremiseHosts.Any())
                            {
                                <h6 class="mt-3">On-Premise Hosts</h6>
                                <div class="table-responsive">
                                    <table class="table table-sm">
                                        <thead>
                                            <tr>
                                                <th>Cloud Provider</th>
                                                <th>Region</th>
                                                <th>Netbox Reference</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var host in Model.OnpremiseHosts)
                                            {
                                                <tr>
                                                    <td>@host.CloudProvider?.Name</td>
                                                    <td>@host.Region</td>
                                                    <td>
                                                        <a href="@host.NetboxReferenceUrl" target="_blank" class="btn btn-outline-info btn-sm">
                                                            <i class="fas fa-external-link-alt"></i> View
                                                        </a>
                                                    </td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            }
                        </div>
                    </div>

                    <!-- Subscription Information -->
                    @if (Model.Subscription != null)
                    {
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5 class="card-title mb-0">
                                    <i class="fas fa-credit-card"></i> Subscription Information
                                </h5>
                            </div>
                            <div class="card-body">
                                <dl class="row">
                                    <dt class="col-sm-3">Subscription:</dt>
                                    <dd class="col-sm-9">@Model.Subscription.Name</dd>
                                    
                                    <dt class="col-sm-3">Seats:</dt>
                                    <dd class="col-sm-9">
                                        <div class="progress" style="height: 20px;">
                                            @{
                                                var usagePercentage = Model.Subscription.SeatsAvailable > 0 
                                                    ? (double)Model.Subscription.SeatsUsed / Model.Subscription.SeatsAvailable * 100 
                                                    : 0;
                                                var progressClass = usagePercentage < 70 ? "bg-success" : usagePercentage < 90 ? "bg-warning" : "bg-danger";
                                            }
                                            <div class="progress-bar @progressClass" role="progressbar" 
                                                 style="width: @usagePercentage%" 
                                                 aria-valuenow="@Model.Subscription.SeatsUsed" 
                                                 aria-valuemin="0" 
                                                 aria-valuemax="@Model.Subscription.SeatsAvailable">
                                                @Model.Subscription.SeatsUsed / @Model.Subscription.SeatsAvailable seats
                                            </div>
                                        </div>
                                    </dd>
                                    
                                    <dt class="col-sm-3">Cost per Seat:</dt>
                                    <dd class="col-sm-9">$@Model.Subscription.CostPerSeatUsd USD</dd>
                                    
                                    <dt class="col-sm-3">Term Duration:</dt>
                                    <dd class="col-sm-9">@Model.Subscription.TermDuration.Days days</dd>
                                    
                                    <dt class="col-sm-3">Total Cost:</dt>
                                    <dd class="col-sm-9">
                                        <strong>$@(Model.Subscription.SeatsUsed * Model.Subscription.CostPerSeatUsd) USD</strong>
                                    </dd>
                                </dl>
                            </div>
                        </div>
                    }
                </div>

                <!-- Sidebar -->
                <div class="col-lg-4">
                    <!-- Quick Stats -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-chart-pie"></i> Quick Stats
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <small class="text-muted">Current Lifecycle Stage</small><br>
                                <span class="badge bg-primary">@Model.Lifecycle?.CurrentStage</span>
                            </div>
                            
                            @if (Model.Subscription != null)
                            {
                                <div class="mb-3">
                                    <small class="text-muted">Seat Utilization</small><br>
                                    @{
                                        var utilization = Model.Subscription.SeatsAvailable > 0 
                                            ? (double)Model.Subscription.SeatsUsed / Model.Subscription.SeatsAvailable * 100 
                                            : 0;
                                    }
                                    <strong>@utilization.ToString("F1")%</strong>
                                </div>
                            }
                            
                            <div class="mb-3">
                                <small class="text-muted">Hosting Location</small><br>
                                <span class="badge @(Model.HostingType == CatalogHostingType.SaaS ? "bg-success" : "bg-warning")">
                                    @Model.HostingType
                                </span>
                                <br>
                                <small class="text-muted mt-1">
                                    <i class="fas fa-globe"></i> @Model.HostingCountry
                                </small>
                            </div>
                            
                            <div class="mb-3">
                                <small class="text-muted">GDPR Compliance</small><br>
                                @if (Model.GdprRegister != null)
                                {
                                    <span class="badge bg-success">Registered</span>
                                }
                                else
                                {
                                    <span class="badge bg-secondary">Not Required</span>
                                }
                            </div>
                        </div>
                    </div>

                    <!-- Lifecycle Information -->
                    @if (Model.Lifecycle != null)
                    {
                        <div class="card mb-4">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="card-title mb-0">
                                    <i class="fas fa-project-diagram"></i> Lifecycle Stages
                                </h5>
                                <button type="button" class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addStageModal">
                                    <i class="fas fa-plus"></i> Add Stage
                                </button>
                            </div>
                            <div class="card-body">
                                @if (Model.Lifecycle.Stages != null && Model.Lifecycle.Stages.Any())
                                {
                                    @foreach (var stage in Model.Lifecycle.Stages.OrderBy(s => s.StartDate))
                                    {
                                        <div class="mb-3">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <span class="badge @(stage.Status == ServiceLifecycleStageStatus.Completed ? "bg-success" : stage.Status == ServiceLifecycleStageStatus.InProgress ? "bg-primary" : "bg-secondary")">
                                                    @stage.StageType
                                                </span>
                                                <small class="text-muted">@stage.Status</small>
                                            </div>
                                            @if (stage.StartDate.HasValue)
                                            {
                                                <small class="text-muted">Started: @stage.StartDate.Value.ToString("yyyy-MM-dd")</small>
                                            }
                                            @if (stage.EndDate.HasValue)
                                            {
                                                <br><small class="text-muted">Completed: @stage.EndDate.Value.ToString("yyyy-MM-dd")</small>
                                            }
                                            @if (!string.IsNullOrEmpty(stage.Sponsor))
                                            {
                                                <br><small class="text-muted">Sponsor: @stage.Sponsor</small>
                                            }
                                        </div>
                                    }
                                }
                                else
                                {
                                    <p class="text-muted">No lifecycle stages recorded yet.</p>
                                }
                            </div>
                        </div>
                    }

                    <!-- GDPR Information -->
                    <div class="card mb-4">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-shield-alt"></i> GDPR Compliance
                            </h5>
                            <button type="button" class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#gdprModal">
                                <i class="fas fa-shield-alt"></i> @(Model.GdprRegister != null ? "Update" : "Set") GDPR
                            </button>
                        </div>
                        <div class="card-body">
                            @if (Model.GdprRegister != null)
                            {
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <small class="text-muted">Data Categories</small><br>
                                            @if (Model.GdprRegister.DataCategories.Any())
                                            {
                                                @foreach (var category in Model.GdprRegister.DataCategories)
                                                {
                                                    <span class="badge bg-info me-1">@category</span>
                                                }
                                            }
                                            else
                                            {
                                                <span class="text-muted">Not specified</span>
                                            }
                                        </div>
                                        
                                        <div class="mb-3">
                                            <small class="text-muted">Processing Frequency</small><br>
                                            <span class="badge bg-warning">@Model.GdprRegister.ProcessingFrequency</span>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <small class="text-muted">Security Measures</small><br>
                                            @if (Model.GdprRegister.SecurityMeasures.Any())
                                            {
                                                @foreach (var measure in Model.GdprRegister.SecurityMeasures)
                                                {
                                                    <span class="badge bg-secondary me-1">@measure</span>
                                                }
                                            }
                                            else
                                            {
                                                <span class="text-muted">Not specified</span>
                                            }
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <small class="text-muted">Employee PII</small><br>
                                            <span class="badge @(Model.GdprRegister.ProcessesEmployeePii ? "bg-warning" : "bg-success")">
                                                @(Model.GdprRegister.ProcessesEmployeePii ? "Yes" : "No")
                                            </span>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <small class="text-muted">External User PII</small><br>
                                            <span class="badge @(Model.GdprRegister.ProcessesExternalUserPii ? "bg-warning" : "bg-success")">
                                                @(Model.GdprRegister.ProcessesExternalUserPii ? "Yes" : "No")
                                            </span>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <small class="text-muted">Processing Agreement</small><br>
                                            <span class="badge @(Model.GdprRegister.HasProcessingAgreement ? "bg-success" : "bg-danger")">
                                                @(Model.GdprRegister.HasProcessingAgreement ? "Yes" : "No")
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                
                                @if (Model.GdprRegister.LastGdprAssessment.HasValue)
                                {
                                    <div class="mt-3 pt-3 border-top">
                                        <small class="text-muted">
                                            <i class="fas fa-clock"></i> Last Assessment: @Model.GdprRegister.LastGdprAssessment.Value.ToString("yyyy-MM-dd")
                                        </small>
                                    </div>
                                }
                            }
                            else
                            {
                                <p class="text-muted mb-0">
                                    <i class="fas fa-info-circle"></i> No GDPR compliance information recorded. 
                                    Click "Set GDPR" to configure compliance settings.
                                </p>
                            }
                        </div>
                    </div>

                    <!-- Actions -->
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-cogs"></i> Actions
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="d-grid gap-2">
                                <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-primary">
                                    <i class="fas fa-edit"></i> Edit Service
                                </a>
                                <a asp-action="Delete" asp-route-id="@Model.Id" class="btn btn-outline-danger">
                                    <i class="fas fa-trash"></i> Delete Service
                                </a>
                                <hr>
                                <button type="button" class="btn btn-outline-info" onclick="exportService()">
                                    <i class="fas fa-download"></i> Export Data
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add Lifecycle Stage Modal -->
<div class="modal fade" id="addStageModal" tabindex="-1" aria-labelledby="addStageModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form asp-action="AddLifecycleStage" method="post">
                <input type="hidden" name="serviceId" value="@Model.Id" />
                <div class="modal-header">
                    <h5 class="modal-title" id="addStageModalLabel">Add New Lifecycle Stage</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="stageType" class="form-label">Stage Type <span class="text-danger">*</span></label>
                        <select name="stageType" class="form-select" required>
                            <option value="">-- Select Stage --</option>
                            @foreach (var stageType in Enum.GetValues<ServiceLifecycleStageType>())
                            {
                                @if (Model.Lifecycle?.Stages?.Any(s => s.StageType == stageType) != true)
                                {
                                    <option value="@stageType">@stageType</option>
                                }
                            }
                        </select>
                        <div class="form-text">Select the next stage in the service lifecycle.</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="sponsor" class="form-label">Sponsor (Optional)</label>
                        <input type="text" name="sponsor" class="form-control" placeholder="e.g., John Doe, IT Department">
                        <div class="form-text">Person or department sponsoring this stage.</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="notes" class="form-label">Notes (Optional)</label>
                        <textarea name="notes" class="form-control" rows="3" placeholder="Any additional notes about this stage..."></textarea>
                    </div>
                    
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i>
                        <strong>Note:</strong> Adding a new stage will automatically complete the current in-progress stage and start the new one.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Add Stage
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- GDPR Compliance Modal -->
<div class="modal fade" id="gdprModal" tabindex="-1" aria-labelledby="gdprModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form asp-action="SetGdprCompliance" method="post">
                <input type="hidden" name="serviceId" value="@Model.Id" />
                <div class="modal-header">
                    <h5 class="modal-title" id="gdprModalLabel">@(Model.GdprRegister != null ? "Update" : "Set") GDPR Compliance</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Section 1: Data Classification -->
                    <div class="card border-light mb-4">
                        <div class="card-header bg-light">
                            <h6 class="card-title mb-0">
                                <i class="fas fa-database text-primary"></i> Data Classification & Processing
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <!-- Data Categories -->
                                    <div class="mb-4">
                                        <label class="form-label fw-bold">Data Categories <span class="text-danger">*</span></label>
                                        <div class="border rounded p-3 bg-light">
                                            @foreach (var category in Enum.GetValues<DataCategory>())
                                            {
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" name="dataCategories" value="@category" id="category_@category"
                                                           @(Model.GdprRegister?.DataCategories?.Contains(category) == true ? "checked" : "") />
                                                    <label class="form-check-label" for="category_@category">@category</label>
                                                </div>
                                            }
                                        </div>
                                    </div>

                                    <!-- Processing Purposes -->
                                    <div class="mb-4">
                                        <label class="form-label fw-bold">Processing Purposes <span class="text-danger">*</span></label>
                                        <div class="border rounded p-3 bg-light" style="max-height: 200px; overflow-y: auto;">
                                            @foreach (var purpose in Enum.GetValues<ProcessingPurpose>())
                                            {
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" name="processingPurposes" value="@purpose" id="purpose_@purpose"
                                                           @(Model.GdprRegister?.ProcessingPurposes?.Contains(purpose) == true ? "checked" : "") />
                                                    <label class="form-check-label" for="purpose_@purpose">@purpose</label>
                                                </div>
                                            }
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <!-- Processing Frequency -->
                                    <div class="mb-4">
                                        <label class="form-label fw-bold">Processing Frequency <span class="text-danger">*</span></label>
                                        <select name="processingFrequency" class="form-select" required>
                                            <option value="">-- Select Frequency --</option>
                                            @foreach (var frequency in Enum.GetValues<ProcessingFrequency>())
                                            {
                                                @if (Model.GdprRegister?.ProcessingFrequency == frequency)
                                                {
                                                    <option value="@frequency" selected>@frequency</option>
                                                }
                                                else
                                                {
                                                    <option value="@frequency">@frequency</option>
                                                }
                                            }
                                        </select>
                                    </div>

                                    <!-- PII Processing -->
                                    <div class="mb-4">
                                        <label class="form-label fw-bold">Personal Data Processing</label>
                                        <div class="border rounded p-3 bg-light">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" name="processesEmployeePii" value="true" id="employeePii"
                                                       @(Model.GdprRegister?.ProcessesEmployeePii == true ? "checked" : "") />
                                                <label class="form-check-label" for="employeePii">Processes Employee PII</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" name="processesExternalUserPii" value="true" id="externalPii"
                                                       @(Model.GdprRegister?.ProcessesExternalUserPii == true ? "checked" : "") />
                                                <label class="form-check-label" for="externalPii">Processes External User PII</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" name="processesSensitiveData" value="true" id="sensitiveData"
                                                       @(Model.GdprRegister?.ProcessesSensitiveData == true ? "checked" : "") />
                                                <label class="form-check-label" for="sensitiveData">Processes Sensitive Data</label>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Sensitive Data Types -->
                                    <div class="mb-4">
                                        <label for="sensitiveDataTypes" class="form-label fw-bold">Sensitive Data Types</label>
                                        <input type="text" name="sensitiveDataTypes" class="form-control" 
                                               value="@(Model.GdprRegister?.SensitiveDataTypes != null ? string.Join(", ", Model.GdprRegister.SensitiveDataTypes) : "")"
                                               placeholder="e.g., health data, financial data">
                                        <div class="form-text">Comma-separated list of sensitive data types.</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Section 2: Security & Compliance -->
                    <div class="card border-light mb-4">
                        <div class="card-header bg-light">
                            <h6 class="card-title mb-0">
                                <i class="fas fa-shield-alt text-success"></i> Security Measures & Compliance
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <!-- Security Measures -->
                                    <div class="mb-4">
                                        <label class="form-label fw-bold">Security Measures</label>
                                        <div class="border rounded p-3 bg-light" style="max-height: 200px; overflow-y: auto;">
                                            @foreach (var measure in Enum.GetValues<SecurityMeasure>())
                                            {
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" name="securityMeasures" value="@measure" id="measure_@measure"
                                                           @(Model.GdprRegister?.SecurityMeasures?.Contains(measure) == true ? "checked" : "") />
                                                    <label class="form-check-label" for="measure_@measure">@measure</label>
                                                </div>
                                            }
                                        </div>
                                    </div>

                                    <!-- Processing Agreement -->
                                    <div class="mb-4">
                                        <label class="form-label fw-bold">Processing Agreement</label>
                                        <div class="border rounded p-3 bg-light">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" name="hasProcessingAgreement" value="true" id="processingAgreement"
                                                       @(Model.GdprRegister?.HasProcessingAgreement == true ? "checked" : "") />
                                                <label class="form-check-label" for="processingAgreement">Has Processing Agreement</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <!-- Data Retention -->
                                    <div class="mb-4">
                                        <label for="dataRetentionDays" class="form-label fw-bold">Data Retention Period</label>
                                        <div class="input-group">
                                            <input type="number" name="dataRetentionDays" class="form-control" 
                                                   value="@(Model.GdprRegister?.DataRetentionPeriod?.Days)"
                                                   placeholder="365">
                                            <span class="input-group-text">days</span>
                                        </div>
                                        <div class="form-text">Maximum period to retain personal data.</div>
                                    </div>

                                    <!-- Data Subject Rights -->
                                    <div class="mb-4">
                                        <label class="form-label fw-bold">Data Subject Rights Support</label>
                                        <div class="border rounded p-3 bg-light">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" name="supportsDataPortability" value="true" id="dataPortability"
                                                       @(Model.GdprRegister?.SupportsDataPortability == true ? "checked" : "") />
                                                <label class="form-check-label" for="dataPortability">Data Portability</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" name="supportsDataDeletion" value="true" id="dataDeletion"
                                                       @(Model.GdprRegister?.SupportsDataDeletion == true ? "checked" : "") />
                                                <label class="form-check-label" for="dataDeletion">Data Deletion (Right to be Forgotten)</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" name="supportsDataCorrection" value="true" id="dataCorrection"
                                                       @(Model.GdprRegister?.SupportsDataCorrection == true ? "checked" : "") />
                                                <label class="form-check-label" for="dataCorrection">Data Correction</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Section 3: Contact & Documentation -->
                    <div class="card border-light mb-4">
                        <div class="card-header bg-light">
                            <h6 class="card-title mb-0">
                                <i class="fas fa-file-contract text-info"></i> Contact Information & Documentation
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="dataProtectionOfficerContact" class="form-label fw-bold">Data Protection Officer Contact</label>
                                        <input type="text" name="dataProtectionOfficerContact" class="form-control" 
                                               value="@Model.GdprRegister?.DataProtectionOfficerContact"
                                               placeholder="e.g., dpo@company.com">
                                        <div class="form-text">Email or contact information for DPO.</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="processingAgreementReference" class="form-label fw-bold">Processing Agreement Reference</label>
                                        <input type="text" name="processingAgreementReference" class="form-control" 
                                               value="@Model.GdprRegister?.ProcessingAgreementReference"
                                               placeholder="e.g., Agreement #123">
                                        <div class="form-text">Reference number or link to processing agreement.</div>
                                    </div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="complianceNotes" class="form-label fw-bold">Compliance Notes</label>
                                <textarea name="complianceNotes" class="form-control" rows="4" 
                                          placeholder="Additional compliance notes, special considerations, or assessment details...">@Model.GdprRegister?.ComplianceNotes</textarea>
                                <div class="form-text">Any additional information about GDPR compliance for this service.</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i>
                        <strong>Note:</strong> This assessment will be timestamped and can be updated as compliance requirements change.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-shield-alt"></i> Save GDPR Compliance
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script>
        function exportService() {
            // TODO: Implement service data export functionality
            alert('Service export functionality will be implemented in a future update.');
        }
    </script>
}